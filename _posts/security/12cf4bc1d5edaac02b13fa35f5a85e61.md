---
title: CSRF 攻击的原理及防御措施是什么？
category: 前端安全
date: 2025-07-06
---
根据参考信息，CSRF（跨站请求伪造）是一种攻击方式，攻击者通过诱导用户在登录状态下访问恶意页面或点击链接，利用用户的浏览器发送已授权的请求到目标网站，导致非预期操作（如资金转账或数据修改）。该攻击的核心是滥用用户的身份验证信息，如 session 或 cookies，执行非本人意愿的操作。  

### CSRF 原理  
- **攻击目标**: CSRF 针对 Web 应用程序进行欺骗操作，攻击者构造恶意请求并通过用户的浏览器发送，但服务器误以为它是用户合法请求，从而执行操作。
- **运作机制**: 攻击者欺骗用户在登录状态下访问一个包含恶意代码的页面（例如通过钓鱼邮件或恶意嵌入的链接）。浏览器的自动请求机制会携带该用户的 cookies（包括身份验证 token），发送恶意操作（如更改账户设置）至服务器。
- **必要条件**: 
  - 用户已登录目标网站。
  - 网站依赖 cookies 或 session ID 进行鉴权。  

### CSRF 的防御措施  
从参考信息可总结，CSRF 的防护侧重于从客户端和服务器端防止恶意请求的执行：
- **使用 CSRF 令牌**: 为每个用户生成一个唯一、难被推测的高强度验证令牌，通常嵌入表单或请求头中。在服务器端验证该令牌以确保请求来源合法。
  ```javascript
  // 示例：在服务器端生成并验证 token
  const generateToken = () => {
    return crypto.randomBytes(16).toString('hex');
  };
  // In server response: <input type="hidden" name="csrf_token" value="token_value">
  // In server validation: compare submitted token with user session token
  ```
- **检查 Referer 头**: 在服务器端对每个请求检查 HTTP 头部的 Referer 字段，确保请求来自可信来源（例如同源域名），如验证是否为合法的原始应用域名而非第三方站点。
- **设置 SameSite Cookie 属性**: 强制 cookies 仅在同站页面发送，防止跨站请求滥用。
  ```javascript
  // 示例：设置 SameSite 属性为 'Lax' 或 'Strict'
  res.cookie('session', 'user_token', {
    maxAge: 24 * 60 * 60 * 1000, // 24 小时有效
    httpOnly: true, // 防 JS 访问
    secure: true, // 只在 HTTPS 下传输
    sameSite: 'Lax' // 限制在导航级别发送 cookie
  });
  ```  
这些措施减少了风险，需在设计与部署中结合应用程序上下文。
