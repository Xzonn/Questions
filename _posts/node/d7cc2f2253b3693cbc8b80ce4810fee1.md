---
title: Node.js 的事件循环机制是怎样的？
category: Node.js
date: 2025-07-07 15:00
difficulty: 中等
excerpt: Node.js 的事件循环机制是其核心，支持异步和并发处理。它分为多个阶段，包括定时器、回调、轮询和检查等，确保高效的 I/O 操作处理。
tags:
- 事件循环
- 异步处理
- 异步
---
Node.js 的事件循环机制是一种核心机制，支持异步和并发处理。它使用 libuv 库实现单线程模型来处理非阻塞 I/O 操作。事件循环将异步任务分成多个有序阶段执行：  

1. **事件循环阶段概述**：Node.js 事件循环分为六个主要阶段，在每个循环迭代中依序执行：  
   - **Timers (定时器阶段)**：执行到期时间设定器（例如 `setTimeout()` 或 `setInterval()`）的回调函数。  
   - **Pending Callbacks (待处理回调阶段)**：处理系统级任务的待处理 I/O 回调，如 TCP 错误或异常恢复操作。  
   - **Idle/Prepare (空闲/准备阶段)**：Node.js 内部功能维护阶段，外部应用通常无需干预。  
   - **Poll (轮询阶段)**：执行大多数 I/O 相关的事件回调（例如文件读写、网络请求），并检测新事件。此阶段会阻塞等待新事件响应超时。  
   - **Check (检查阶段)**：执行 `setImmediate()` 设定的回调函数执行优先级任务。  
   - **Close Callbacks (关闭回调阶段)**：处理关闭操作（例如 `socket.on('close')`）的回调函数。  

2. **工作原理流程解析**：  
   - **初始化阶段**：当 Node.js 启动时，主线程执行同步代码序列。之后进入事件循环队列中监测状态变化过程。  
     ```javascript
     // 示例伪代码（模拟核心事件循环执行流程）
     while (true) {
       checkExpiredTimers(); // 处理Timers
       processPendingTasks(); // 处理Pending Callbacks
       if (eventAvailable()) executePollTasks(); // Poll可能阻塞待机触发新的队列项
       checkImmediates(); // 执行setImmediate函数
     }
     ```  
   - **阶段流转顺序**：一旦某个阶段的队列执行完毕事件会转入下一个指定区域段执行操作。  
   - **回调执行逻辑**：对耗时操作进行非阻塞调用系统处理完成添加到下一个迭代检查节点等待主线程调用。  

3. **关键特点影响性能与同步处理方式不同点区分开来设计方法**：通过这种方式避免主线程长期阻塞并保持较高性能指标扩展点提升处理效率以满足系统大规模应用的需求能力需求扩展点。
