---
title: 服务器 CPU 过高时如何排查及解决问题？
category: 部署与运维
date: 2025-07-06 20:05
---
排查和解决服务器 CPU 过高的关键步骤如下：

### 1. 初步排查：识别问题来源
   - **使用命令行工具**：
     - 运行 `top` 或 `htop` 命令，查看 CPU 占用率高的进程，关注 PID 和 %CPU 指标。
     - 使用 `ps aux --sort=-%cpu | head -n 10` 筛选出占用最高的进程前 10 名。
   - 分析是否由特定服务引起，如数据库、Web Server 或应用代码。
   - 建议检查不必要后台程序；关闭异常进程通过 `kill -9 PID`（谨慎操作）。

### 2. 深入诊断：定位原因类型
   - **负载模式分析**：
     - 运行 `vmstat 1` 查看 CPU 等待、内存情况；`iostat` 检查磁盘 I/O 是否堵塞 CPU。
     - 判断是否突发高负载 (如流量突增) 或持续高负载 (代码缺陷)。
   - **软件问题**：
     - 若占用的进程是应用服务，用调试工具（如 Profiler）检查线程和函数调用。
     - 参考，排查无限循环脚本：检查应用程序代码 (e.g., 用 `strace` 跟踪系统调用)。
   - **硬件/系统问题**：
     - 散热因素：强调清除 CPU 风扇灰尘，应用新导热硅脂（服务器环境需专业操作）。
     - 电源问题：指出电源功率不足或老化；监控传感器数据（`lm-sensors`）。

### 3. 立即临时解决措施
   - **重启服务或进程**：暂停高占用服务如 `systemctl stop service_name`，并重启减轻压力。
   - **优化服务配置**：
     - 降低优先级：`renice -n 19 -p PID`。
     - 限流设置如 NGINX 的 `rate_limit`。
   - **扩充资源**：添加节点扩展集群。

### 4. 长期解决方案
   - **代码优化**：
     - 用建议优化逻辑，避免阻塞循环，确保事件驱动设计。
     - Profiler 扫描资源泄漏点。
   - **运维优化**：
     - 部署监控系统如 Prometheus,设置报警阈值。
     - 硬件维护：定期清灰换风扇；参考服务器厂商指南。
     - Autoscaling：在云平台上配置自动伸缩组处理流量峰值。

   Example bash 命令查看 CPU：
   ```
   top -b -n 1 | head -15
   ```
